# -- The hostname for the Firemetrics instance (deprecated, use ingress.fqdn instead).
hostname: ""

ingress:
  # -- The FQDN for the Firemetrics instance.
  fqdn: "example.com"
  # -- The HTTP port for the Firemetrics instance.
  http_port: 80
  # -- The HTTPS port for the Firemetrics instance.
  https_port: 443

tls:
  # -- Enable TLS for the Firemetrics instance.
  enabled: false

  # -- Name of the Kubernetes secret containing the TLS certificate and key. Defaults to "{prefix}-tls-cert".
  secretNameOverride: ""
  # -- Disable automatic creation of the TLS secret.
  existingSecret: false

  certManager:
    # -- Enable cert-manager integration for automatic TLS certificate management.
    enabled: false
    # -- Name of the cert-manager ClusterIssuer to use for TLS certificate issuance.
    issuer: letsencrypt

caCertsConfigMap:
  # -- Enable the creation of a ConfigMap containing CA certificates.
  enabled: false
  # -- Name of the ConfigMap containing CA certificates. Defaults to "{prefix}-ca-certs".
  nameOverride: ""
  # -- The file name of the CA certificates in the ConfigMap.
  fileName: ca-certificates.crt
  # -- The content of the CA certificates. If empty, `caCertsConfigMap.existingConfigMap` must be set to true.
  data: ""
  # -- Disable automatic creation of the CA certificates ConfigMap.
  existingConfigMap: false

# -- The URL of the Firemetrics Helm charts repository.
chartRepoUrl: "https://nexus.firemetricshealth.com/repository/helm-firemetrics/"

# -- The version of the Firemetrics Helm charts to use. Defaults to the current chart's version.
chartRevisionOverride: ""

# -- The namespace where Argo CD is installed.
argoCdNamespace: argocd

# -- The sync policy used for all applications created by this chart.
syncPolicy:
  automated:
    prune: false
    selfHeal: false

oidc:
  # -- Enable OIDC authentication for the Firemetrics instance.
  enabled: true
  # -- The OIDC discovery URL. Defaults to the Keycloak instance created by this chart.
  discoveryUrlOverride: ""
  # -- The OIDC authentication URL. Defaults to the Keycloak instance created by this chart.
  authUrlOverride: ""
  # -- The OIDC token URL. Defaults to the Keycloak instance created by this chart.
  tokenUrlOverride: ""
  # -- The OIDC user info URL. Defaults to the Keycloak instance created by this chart.
  userinfoUrlOverride: ""
  # -- The OIDC sign-out URL. Defaults to the Keycloak instance created by this chart.
  signoutUrlOverride: ""
  # -- The Keycloak realm used for OIDC authentication. Only relevant if Keycloak is enabled.
  keycloakRealm: firemetrics

database:
  # -- The database name used by the Firemetrics instance.
  dbname: firemetrics
  # -- The database port used by the Firemetrics instance.
  port: 5432
  # -- The database host used by the Firemetrics instance. Defaults to the Postgres cluster created by this chart.
  hostnameOverride: ""
  # -- The database super user used by the Firemetrics instance to manage the Postgres instance. Defaults to the user created by Postgres Operator.
  existingSuperUserSecret: ""

backup:
  # -- Enable WAL archiving for the Postgres cluster.
  enabled: false
  # -- The name of the S3 bucket used for WAL archiving.
  bucketName: "backup"
  # -- The S3 bucket region used for WAL archiving.
  region: "auto"
  # -- The S3 bucket endpoint used for WAL archiving.
  endpoint: "http://minio"
  userSecret:
    # -- The secret containing the S3 user credentials for WAL archiving.
    name: minio-user
    # -- The key in the secret containing the S3 access key.
    accessKeyKey: accessKey
    # -- The key in the secret containing the S3 secret key.
    secretKeyKey: secretKey

# -- The image pull secret used for the Firemetrics instance.
imagePullSecret: ""

# -- The image used for the Spilo Postgres cluster pods.
spiloImage: ghcr.io/firemetrics/spilo17:4.0-p2-v0.7.0

# -- The number of worker processes to start for background tasks.
workerCount: 4

referentialIntegrity:
  # -- Enable referential integrity enforcement on create and update operations. Defaults to `false` for performance reasons.
  enforceOnWrite: false
  # -- Enable referential integrity enforcement on delete operations. Defaults to `false` for performance reasons.
  enforceOnDelete: false

components:
  postgres:
    # -- Enable the Postgres cluster managed by Postgres Operator.
    enabled: true

    # -- The number of Postgres instances in the cluster.
    numberOfInstances: 1
    # -- The name of the Postgres cluster. Defaults to "postgres-pod".
    podServiceAccountNameOverride: ""
    # -- The name of the Postgres cluster. Defaults to "{prefix}-postgres".
    clusterNameOverride: ""

    # -- Enable the creation of a LoadBalancer service for the Postgres master pod.
    enableMasterLoadBalancer: false
    # -- Enable the creation of a LoadBalancer service for the Postgres master pod.
    enableReplicaLoadBalancer: false
    # -- List of CIDR blocks allowed to access the Postgres cluster if `enableMasterLoadBalancer` is true. Use `["0.0.0.0/0"]` to allow access from anywhere.
    allowedSourceRanges: []

    # -- The name of the team that owns the Postgres cluster.
    teamId: ""
    spiloRunAsUser: 101
    spiloRunAsGroup: 103
    spiloFSGroup: 103

    volume:
      # -- The size of the Postgres data volume.
      size: 10Gi

    # -- The resource requests and limits for the Postgres cluster pods.
    resources:
      requests:
        cpu: "10m"
        memory: "100Mi"
      limits:
        cpu: "32"
        memory: "128Gi"

    # -- The [PostgreSQL parameters](https://github.com/zalando/postgres-operator/blob/v1.14.0/docs/reference/cluster_manifest.md#postgres-parameters).
    postgresql:
      version: "17"
      parameters:
        shared_buffers: 2GB
        max_locks_per_transaction: "512"
        work_mem: "256MB"

        # Do not omit some default extensions, otherwise bootstrap will fail
        # https://github.com/zalando/spilo/issues/1043
        shared_preload_libraries: "bg_mon,pg_stat_statements,pgextwlist,pg_auth_mon,set_user,timescaledb,pg_cron,pg_stat_kcache,fhirql"

    # -- Extra environment variables for the Postgres cluster pods.
    extraEnv: []

    # -- Override the values for the Postgres cluster Helm chart.
    valuesOverride: {}

  bootstrap:
    # -- Enable the database bootstrap job.
    enabled: true
    # -- The security context for the bootstrap job.
    securityContext: {}
    # -- Override the values for the bootstrap job Helm chart.
    valuesOverride: {}

  fuego:
    # -- Enable the Fuego component.
    enabled: true
    # -- The image used for the Fuego pods.
    image: ghcr.io/firemetrics/fuego:v0.7.0
    # -- Extra environment variables for the Fuego pods.
    env: []
    logging:
      # -- The log format for Fuego ("plain" or "json").
      format: json
    # -- Extra volumes for the Fuego pods.
    volumes: []
    # -- Extra volume mounts for the Fuego pods.
    volumeMounts: []
    # -- The security context for the Fuego pods.
    securityContext: {}
    # -- Liveness probe configuration for the Fuego pods.
    livenessProbe: {}
    # -- Readiness probe configuration for the Fuego pods.
    readinessProbe: {}
    oidcClientSecret:
      # -- The secret containing the OIDC client credentials for Fuego.
      name: fuego-oidc-client
      # -- The key in the secret containing the OIDC client ID.
      idKey: id
      # -- The key in the secret containing the OIDC client secret.
      secretKey: secret
    hapi:
      # -- Enable the HAPI FHIR facade service.
      enabled: true
      # -- The image used for the HAPI pods.
      image: ghcr.io/firemetrics/fmx-hapi-facade:0.1.6
      # -- Extra init containers for the HAPI pods.
      initContainers: []
      # -- Extra environment variables for the HAPI pods.
      env: []
      # -- Extra volumes for the HAPI pods.
      volumes: []
      # -- Extra volume mounts for the HAPI pods.
      volumeMounts: []
      # -- The security context for the HAPI pods.
      securityContext: {}
      features:
        validation:
          # -- Enable FHIR validation feature.
          enabled: true
      oidcClientSecret:
        # -- The secret containing the OIDC client credentials for HAPI.
        name: hapi-oidc-client
        # -- The key in the secret containing the OIDC client ID.
        idKey: id
        # -- The key in the secret containing the OIDC client secret.
        secretKey: secret
    # -- Override the values for the Fuego Helm chart.
    valuesOverride: {}

  panel:
    # -- Enable the Panel component.
    enabled: true
    # -- The image used for the Panel pods.
    image: ghcr.io/firemetrics/fmx-panel:v1.3.0
    # -- Extra environment variables for the Panel pods.
    env: []
    # -- Extra volumes for the Panel pods.
    volumes: []
    # -- Extra volume mounts for the Panel pods.
    volumeMounts: []
    # -- The security context for the Panel pods.
    securityContext: {}
    # -- The public path for the Panel.
    publicPath: /panel
    # -- The features enabled in the Panel.
    featureFlags:
      - resource_explorer
      - nocode_builder
      - sql_editor
    oidc:
      # -- The OIDC audience used by the Panel. Defaults to the public URL of the Panel.
      audience: ""
      clientSecret:
        # -- The secret containing the OIDC client credentials for Panel.
        name: panel-oidc-client
        # -- The key in the secret containing the OIDC client ID.
        idKey: id
        # -- The key in the secret containing the OIDC client secret.
        secretKey: secret
    databaseUserSecret:
      # -- The secret containing Panel database user credentials.
      name: panel-db-user
      # -- The key in the secret containing the Panel database username.
      usernameKey: username
      # -- The key in the secret containing the Panel database password.
      passwordKey: password
    openaiApiKeySecret:
      # -- Enable the OpenAI API key for the Panel.
      enabled: false
      # -- The secret containing the OpenAI API key for the Panel.
      name: openai-api-key
      # -- The key in the secret containing the OpenAI API key for the Panel.
      key: api-key
    # -- Override the values for the Panel Helm chart.
    valuesOverride: {}

  grafana:
    # -- Enable the Grafana component.
    enabled: true
    # -- The public path for Grafana.
    publicPath: /grafana
    # -- The image used for Grafana pods.
    image: ghcr.io/firemetrics/firemetrics-dashboards:01e5524
    # -- Extra environment variables for Grafana pods.
    env: []
    # -- Extra volumes for Grafana pods.
    volumes: []
    # -- Extra volume mounts for Grafana pods.
    volumeMounts: []
    # -- The security context for Grafana pods.
    securityContext: {}
    # -- Liveness probe configuration for Grafana pods.
    livenessProbe:
      httpGet:
        path: /api/health
        port: 3000
      periodSeconds: 10
      timeoutSeconds: 30
      failureThreshold: 30
    # -- Readiness probe configuration for Grafana pods.
    readinessProbe:
      httpGet:
        path: /api/health
        port: 3000
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 30
      failureThreshold: 3
    databaseUserSecret:
      # -- The secret containing Grafana database user credentials.
      name: grafana-db-user
      # -- The key in the secret containing the Grafana database username.
      usernameKey: username
      # -- The key in the secret containing the Grafana database password.
      passwordKey: password
    oidcClientSecret:
      # -- The secret containing the OIDC client credentials for Grafana.
      name: grafana-oidc-client
      # -- The key in the secret containing the OIDC client ID.
      idKey: id
      # -- The key in the secret containing the OIDC client secret.
      secretKey: secret
    persistence:
      # -- Enable persistence for Grafana.
      enabled: true
      # -- The size of the Grafana data volume.
      requestedStorage: "2Gi"
    # -- Override the values for the Grafana Helm chart.
    valuesOverride: {}

  keycloak:
    # -- Enable the Keycloak component.
    enabled: true
    # -- The image used for the Keycloak pods.
    image: "quay.io/keycloak/keycloak:26.3.2"
    # -- The database name used by Keycloak.
    databaseName: keycloak
    # -- Extra environment variables for the Keycloak pods.
    env: []
    # -- Extra volumes for the Keycloak pods.
    volumes: []
    # -- Extra volume mounts for the Keycloak pods.
    volumeMounts: []
    # -- The security context for the Keycloak pods.
    securityContext: {}
    # -- The public path for Keycloak.
    publicPath: /auth
    # -- Enable realm initialization for Keycloak.
    importRealm: true
    databaseUserSecret:
      # -- The secret containing the Keycloak database user credentials.
      name: keycloak-db-user
      # -- The key in the secret containing the Keycloak database username.
      usernameKey: username
      # -- The key in the secret containing the Keycloak database password.
      passwordKey: password
    adminSecret:
      # -- The secret containing the Keycloak admin credentials.
      name: keycloak-admin
      # -- The key in the secret containing the Keycloak admin username.
      usernameKey: username
      # -- The key in the secret containing the Keycloak admin password.
      passwordKey: password
    # -- Override the values for the Keycloak Helm chart.
    valuesOverride: {}

  minio:
    # -- Enable the MinIO component.
    enabled: true
    # -- The image used for the MinIO pods.
    chartRepoUrl: "https://operator.min.io"
    # -- The size of the MinIO data volume.
    size: "10Gi"
    # -- The configuration secret for MinIO.
    configSecretName: "minio-config"
    exposedService:
      # -- Enable the creation of an exposed service for direct MinIO access.
      enabled: false
      # -- The service port for the exposed MinIO service.
      servicePort: 9000
      # -- The service type for the exposed MinIO service.
      serviceType: LoadBalancer
    # -- Override the values for the MinIO Helm chart.
    valuesOverride: {}

  ingress:
    # -- Enable the ingress component.
    enabled: true
    # -- Override the values for the ingress Helm chart.
    valuesOverride: {}

  dicom:
    # -- Enable the DICOM component.
    enabled: true
    # -- The security context for the DICOM pods.
    securityContext: {}
    receiver:
      # -- Enable the DICOM receiver.
      enabled: true
      # -- The image used for the DICOM receiver pods.
      image: ghcr.io/firemetrics/dicom_receiver:v0.7.0
      # -- Extra environment variables for the DICOM receiver pods.
      env: []
      # -- Extra volumes for the DICOM receiver pods.
      volumes: []
      # -- Extra volume mounts for the DICOM receiver pods.
      volumeMounts: []
      exposedService:
        # -- Enable the creation of an exposed service for direct DICOM receiver access.
        enabled: false
        # -- The service port for the exposed DICOM receiver service.
        servicePort: 11112
        # -- The service type for the exposed DICOM receiver service.
        serviceType: LoadBalancer
      migration:
        # -- Enable the migration init container to run database migrations before starting the receiver.
        enabled: false
      dicom:
        # -- The log level for the DICOM receiver.
        logLevel: INFO
        # -- The log format for the DICOM receiver ("plain" or "json").
        logFormat: json
        # -- The Application Entity Title (AET) for the DICOM receiver.
        aet: FMX
        # -- The number of worker threads for the DICOM receiver.
        numThreads: 8
      databaseUserSecret:
        # -- The secret containing DICOM receiver database user credentials.
        name: dicom-receiver-db-user
        # -- The key in the secret containing the DICOM receiver database username.
        usernameKey: username
        # -- The key in the secret containing the DICOM receiver database password.
        passwordKey: password
    web:
      # -- Enable the DICOMweb server.
      enabled: true
      # -- The image used for the DICOMweb server pods.
      image: ghcr.io/umessen/dicom-rst-s3:latest
      # -- Extra environment variables for the DICOMweb server pods.
      env: []
      # -- Extra volumes for the DICOMweb server pods.
      volumes: []
      # -- Extra volume mounts for the DICOMweb server pods.
      volumeMounts: []
      exposedService:
        # -- Enable the creation of an exposed service for direct DICOMweb server access.
        enabled: false
        # -- The service port for the exposed DICOMweb server service (HTTP).
        servicePort: 11122
        # -- The service type for the exposed DICOMweb server service.
        serviceType: LoadBalancer
      server:
        # -- The log level for the DICOMweb server.
        logLevel: INFO
        # -- The Application Entity Title (AET) for the DICOMweb server.
        aet: FMX
        # -- The maximum upload size in bytes for the DICOMweb server.
        maxUploadSize: 50000000
        # -- The request timeout in milliseconds for the DICOMweb server.
        requestTimeout: 60000
        # -- Enable graceful shutdown for the DICOMweb server.
        gracefulShutdown: true
      s3:
        # -- The Application Entity Title (AET) for DICOM storage.
        aet: S3_STORAGE
        # -- The STOW-RS timeout in milliseconds.
        stowTimeout: 10000
        # -- The S3 concurrency level for the DICOMweb server.
        concurrency: 8
    s3:
      # -- Enable S3 storage for DICOM files.
      enabled: false
      # -- The S3 bucket endpoint URL.
      endpoint: "http://minio"
      # -- The S3 endpoint syntax style (path or vhost).
      endpointSyntax: "path"
      # -- The S3 bucket name for DICOM files.
      bucketName: "dicom"
      # -- The S3 bucket region.
      region: "auto"
      userSecret:
        # -- The secret containing S3 user credentials for DICOM storage.
        name: minio-user
        # -- The key in the secret containing the S3 access key.
        accessKeyKey: accessKey
        # -- The key in the secret containing the S3 secret key.
        secretKeyKey: secretKey
    # -- Override the values for the DICOM Helm chart.
    valuesOverride: {}

  loki:
    # -- Enable the Loki log aggregation component.
    enabled: false
    loki:
      # -- Enable Loki deployment.
      enabled: true
      # -- The image used for Loki pods.
      image: grafana/loki:3.4.2
      config:
        # -- Log retention period (default: 31 days).
        retentionPeriod: 744h
    persistence:
      # -- Enable persistence for Loki data.
      enabled: true
      # -- The size of the Loki data volume.
      requestedStorage: "10Gi"
    service:
      # -- Enable the Loki service.
      enabled: true
      # -- Override the service name.
      nameOverride: ""
    alloy:
      # -- Enable Alloy log collector deployment.
      enabled: true
      # -- The image used for Alloy pods.
      image: grafana/alloy:v1.12.2
      config:
        # -- List of namespaces to collect logs from. Empty list means all namespaces.
        namespaces: []
        jsonProcessing:
          # -- JSON fields to extract and promote to indexed labels.
          # -- Common fields: level, msg, message, error, caller, ts.
          labelFields:
            - level
    # -- Override the values for the Loki Helm chart.
    valuesOverride: {}
